---
title: "ABNB_Hawaii_2023"
author: "ZW"
date: '2023-03-15'
output: html_document
---

# Hawaii ABNB Data (12/15/2022)
## Data source: http://insideairbnb.com/get-the-data/
## load package
```{r}
library (tidyverse)
```
## load data files
```{r}
calendar <- read_csv("Data_Science/ABNB_data/Hawaii_12-15-22/calendar.csv")
colnames(calendar)
listings <- read_csv("Data_Science/ABNB_data/Hawaii_12-15-22/listings.csv")
colnames(listings)
```
## Show top twenty hosts by the number of listings
```{r}
listings_host <- listings %>% group_by(host_name) %>% summarise (listing=n()) %>% arrange (desc(listing))
listings_host %>% filter (listing > 185)
```

## Generated a listings file with fewer variables
### This file will be further analyzed using Tableau
```{r}
listings_short <- listings %>% 
  select (c("id", "neighbourhood_cleansed","neighbourhood_group_cleansed", "latitude","longitude","property_type","room_type","accommodates","price", "minimum_nights","maximum_nights")) %>%
  rename ("Island" = "neighbourhood_group_cleansed") %>%
  rename ("Neighbourhood" = "neighbourhood_cleansed")
```

### Replace values of two variables
```{r}
listings_short$Island[listings_short$Island == "Honolulu"] <- "Oahu"
listings_short$Neighbourhood[listings_short$Neighbourhood == "Primary Urban Center"] <- "Honolulu"
listings_short <- listings_short
```

### Calculate occupancy from the calendar file; merge with "listings_short"
```{r}
booking <- calendar %>% 
  group_by(listing_id, available) %>% 
  summarise(days = n()) %>% 
  mutate(booking_rate=days/3.65) %>%
  filter (available == FALSE) %>%
  select (listing_id, booking_rate) %>%
  rename ("id" = "listing_id")
listings_short2 <- merge (listings_short, booking, by = "id")
## Remove special characters in the "price" column
listings_short2$price <- gsub('[,]', '', listings_short2$price)
listings_short2$price <- gsub('[$]', '', listings_short2$price)
listings_short2$price <- as.numeric(listings_short2$price)
```

### Room Type plot
```{r}
ggplot(listings_short2, aes(room_type)) + geom_bar(aes(fill = Island)) + ggtitle("All Listings by Room Type") + ylab("Number of Listing") + xlab("Room Type")
```
### home/apt price plot
```{r}
listings_short2 %>% filter (room_type == "Entire home/apt") %>%
  ggplot (aes(x=Island, y=price, fill=Island)) + 
  geom_bar(stat="summary", fun = "median") + 
  ggtitle("Median Price of entire home/apt") +
  ylab("Median Price ($)")
```

### Calculate daily booking rate for the next 12 months
```{r}
calendar_short <- calendar %>% group_by(date, available) %>% summarise(listing = n())
avail_true <- calendar_short %>% filter (available == TRUE) %>%
  rename ("listing_true" = "listing") %>%
  select (c("date", "listing_true"))
avail_false <- calendar_short %>% 
  filter (available == FALSE) %>%
  rename ("listing_false" = "listing") %>%
  select (c("date", "listing_false"))
availibility <- merge(avail_true, avail_false, by = "date")
daily_booking <- availibility %>% mutate(total = listing_false + listing_true) %>% mutate(daily_booking_rate=100*listing_false/total)
```
### Plot booking rate data
```{r}
ggplot(daily_booking, aes(x=date, y=daily_booking_rate)) + 
  geom_line() + ggtitle("Overall Booking Rate for the next 12 Months as of 12/15/2022") +
  ylab("Daily Booking Rate (%)")
```

### Calculate daily price
```{r}
##Remove special characters in the adjusted_price column
calendar$adjusted_price <- gsub('[,]', '', calendar$adjusted_price)
calendar$adjusted_price <- gsub('[$]', '', calendar$adjusted_price)
calendar$adjusted_price <- as.numeric(calendar$adjusted_price)
##Calculate median price
price <- calendar %>% group_by (date) %>% filter (adjusted_price > 0) %>% 
  summarise (median_price = median(adjusted_price))
```
### Plot daily price data
```{r}
ggplot(price, aes(x=date, y=median_price)) +
  geom_line() + ggtitle("Median Daily Price of All Lisitngs") +
  ylab("Median Price ($)")
```

## Export files as csv
```{r}
write.csv(listings_short2, "Data_Science/ABNB_data/Hawaii_12-15-22/listing_short.csv", row.names = FALSE)
write.csv(daily_booking, "Data_Science/ABNB_data/Hawaii_12-15-22/daily_booking.csv", row.names = FALSE)
write.csv(price, "Data_Science/ABNB_data/Hawaii_12-15-22/daily_price.csv", row.names = FALSE)
```
